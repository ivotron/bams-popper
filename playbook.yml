- hosts: all
  roles:
  - role: angstwad.docker_ubuntu
    docker_opts: "--host tcp://0.0.0.0:2375"
  tasks:
  - name: create temp folder
    file: path=/tmp/wrf state=directory mode=0755
  - name: transfer compose files
    copy: src=docker-compose.yml dest=/tmp/wrf/docker-compose.yml mode=0644
  - name: remove stopped containers
    shell: docker-compose rm -f chdir=/tmp/wrf
    environment:
      DOCKER_HOST: tcp://0.0.0.0:2375
  - name: execute wrf
    shell: docker-compose up chdir=/tmp/wrf
    environment:
      DOCKER_HOST: tcp://0.0.0.0:2375
  - name: list output files
    shell: ls /tmp/wrf/wrfoutput
    register: files_to_copy
  - name: fetch results files to compare
    fetch: src=/tmp/wrf/wrfoutput/{{ item }} dest=wrfoutput/{{ inventory_hostname }}/ flat=yes
    with_items: files_to_copy.stdout_lines
  - name: compare files to see if they are equal
    local_action: command ./compare_results
